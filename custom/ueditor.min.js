"use strict";window.uEditor=function(){var e={init:function(){e.bbPanelLoaded=!(1===uCoz.editor.type);var o=$(document.addform||document.goodsform),t=o.find(".edtTypeMenu");t.find("b").hide(),t.find("[data-uemode="+uCoz.editor.type+"]").hide().next("b").show(),e.addEventListeners(o),e.$bbPanel=$(".ucoz-editor-bbpanel"),e.$htPanel=$(".ucoz-editor-htpanel"),1===uCoz.editor.type&&o.find(".ucoz-editor-bottom").hide(),2===uCoz.editor.type&&e.$bbPanel.show(),3===uCoz.editor.type&&e.$htPanel.show(),document.addform&&(document.addform.brief&&e.checkSymbolsCount(document.addform.brief),document.addform.message&&e.checkSymbolsCount(document.addform.message))},addEventListeners:function(o){o.find(".edtTypeMenu").on("click","a",(function(){var t=$(this).data("uemode"),n=$(this).parents(".edtTypeMenu"),i=n.data("uetarget");switch(o.find("#edtt"+i).val(t),n.find("a").show(),n.find("b").hide(),$(this).hide().next("b").show(),uCoz.editor[i+"Type"]=uCoz.editor[i+"Type"]||uCoz.editor.type,t){case 1:e.showVisual(i);break;case 2:e.showBB(i);break;case 3:e.showHTML(i);break;default:e.showBase(i)}var d=$("#format_"+i);1===t||3===t?d.prop("checked",!1).removeAttr("checked"):d.prop("checked",!0).attr("checked","checked"),uCoz.editor[i+"Type"]=t,document.addform&&(document.addform.brief&&e.checkSymbolsCount(document.addform.brief),document.addform.message&&e.checkSymbolsCount(document.addform.message))})),o.on("reset",(function(){if("undefined"!=typeof CKEDITOR&&CKEDITOR.instances)for(var e in CKEDITOR.instances)CKEDITOR.instances.hasOwnProperty(e)&&CKEDITOR.instances[e].setData($("#"+e).val())}))},showVisual:function(o){var t=$("#"+o),n=t.parent();$("#cke_"+o).show(),t.css({display:"none",visibility:"hidden"}),n.find(".ucoz-editor-panel").hide(),n.find(".ucoz-editor-bottom").hide(),"undefined"!=typeof CKEDITOR?CKEDITOR.replace(o,{height:$("#"+o).height(),language:uCoz.language}):e.createVisual(o)},showBB:function(o){var t=$("#"+o),n=t.parent();$("#cke_"+o).hide(),t.css({display:"block",visibility:"visible"}),n.find(".ucoz-editor-htpanel").hide(),n.find(".ucoz-editor-bbpanel").show(),n.find(".ucoz-editor-bottom").show(),e.bbPanelLoaded||$.getScript(uCoz.editor.bbcodes_src,(function(){})),1===uCoz.editor[o+"Type"]&&"undefined"!=typeof CKEDITOR&&CKEDITOR.instances&&CKEDITOR.instances[o]&&(CKEDITOR.instances[o].updateElement(),CKEDITOR.instances[o].destroy())},showHTML:function(o){var t=$("#"+o),n=t.parent();$("#cke_"+o).hide(),t.css({display:"block",visibility:"visible"}),n.find(".ucoz-editor-bbpanel").hide(),n.find(".ucoz-editor-htpanel").show(),n.find(".ucoz-editor-bottom").show(),e.bbPanelLoaded||$.getScript(uCoz.editor.bbcodes_src,(function(){e.bbPanelLoaded=!0})),1===uCoz.editor[o+"Type"]&&"undefined"!=typeof CKEDITOR&&CKEDITOR.instances&&CKEDITOR.instances[o]&&(CKEDITOR.instances[o].updateElement(),CKEDITOR.instances[o].destroy())},showBase:function(e){var o=$("#"+e),t=o.parent();$("#cke_"+e).hide(),o.css({display:"block",visibility:"visible"}),t.find(".ucoz-editor-bbpanel").hide(),t.find(".ucoz-editor-htpanel").hide(),t.find(".ucoz-editor-bottom").hide(),1===uCoz.editor[e+"Type"]&&"undefined"!=typeof CKEDITOR&&CKEDITOR.instances&&CKEDITOR.instances[e]&&(CKEDITOR.instances[e].updateElement(),CKEDITOR.instances[e].destroy())},createVisual:function(e){$.ajax({url:uCoz.editor.ckeditor_src,dataType:"script",async:!1,success:function(){CKEDITOR.replace(e,{height:$("#"+e).height(),language:uCoz.language})},error:function(e,o,t){console&&console.log&&console.log(o+", "+t)}})},checkSymbolsCount:function(e){return window[e.name+"SymbolsStat"]&&(window[e.name+"WordsCount"].innerHTML=e.value.split(" ").filter((function(e){return!!e})).length,window[e.name+"SymbolsCount"].innerHTML=e.value.length+"/"+e.value.replace(/\s/g,"").length)}};return{init:e.init,checkSymbolsCount:e.checkSymbolsCount}}(),document.addEventListener("DOMContentLoaded",uEditor.init);